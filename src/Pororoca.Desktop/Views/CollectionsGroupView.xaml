<UserControl
    xmlns="https://github.com/avaloniaui"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:vm="clr-namespace:Pororoca.Desktop.ViewModels;assembly=Pororoca.Desktop"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    d:DesignWidth="1350"
    d:DesignHeight="700"
    x:Class="Pororoca.Desktop.Views.CollectionsGroupView"
    x:CompileBindings="True"
    x:DataType="vm:CollectionsGroupViewModel"
    FontSize="14">

  <TreeView
      x:Name="itemsTree"
      Margin="0 40 0 20"
      ItemsSource="{Binding Items}"
      SelectedItem="{Binding CollectionGroupSelectedItem, Mode=TwoWay}"
      SelectedItems="{Binding CollectionGroupSelectedItems, Mode=TwoWay}"
      SelectionMode="Multiple"
      ScrollViewer.HorizontalScrollBarVisibility="Disabled"
      Classes="sidebar DragAndDrop CollectionOrganizationItemDragAndDrop">
      <TreeView.KeyBindings>
        <!-- Commands need to be defined for both keybindings and context menu actions -->
        <!-- Keyboard shortcuts are defined in CollectionsGroupView and MainWindow -->
        <KeyBinding Command="{Binding HotKeys.CutCmd, Mode=OneWay}" Gesture="Ctrl+X" />
        <KeyBinding Command="{Binding HotKeys.CopyCmd, Mode=OneWay}" Gesture="Ctrl+C" />
        <KeyBinding Command="{Binding HotKeys.PasteCmd, Mode=OneWay}" Gesture="Ctrl+V" />
        <KeyBinding Command="{Binding HotKeys.DeleteCmd, Mode=OneWay}" Gesture="Delete" />
        <KeyBinding Command="{Binding HotKeys.DuplicateCmd, Mode=OneWay}" Gesture="Ctrl+D" />
    </TreeView.KeyBindings>
    <TreeView.Styles>
      <!-- Items in the ItemsSource need to have these properties for the binding to work -->
      <!-- Because we are used CompiledBindings now, we need to declare x:DataType for each expandable vm -->
      <Style
          Selector="TreeViewItem"
          x:DataType="vm:CollectionViewModel">
        <Setter
            Property="IsExpanded"
            Value="{Binding IsExpanded, Mode=TwoWay}"/>
      </Style>
      <Style
          Selector="TreeViewItem"
          x:DataType="vm:CollectionFolderViewModel">
        <Setter
            Property="IsExpanded"
            Value="{Binding IsExpanded, Mode=TwoWay}"/>
      </Style>
      <Style
          Selector="TreeViewItem"
          x:DataType="vm:EnvironmentsGroupViewModel">
        <Setter
            Property="IsExpanded"
            Value="{Binding IsExpanded, Mode=TwoWay}"/>
      </Style>
      <Style
          Selector="TreeViewItem"
          x:DataType="vm:WebSocketConnectionViewModel">
        <Setter
            Property="IsExpanded"
            Value="{Binding IsExpanded, Mode=TwoWay}"/>
      </Style>
    </TreeView.Styles>
    <TreeView.DataTemplates>

      <TreeDataTemplate
          DataType="{x:Type vm:CollectionViewModel}"
          ItemsSource="{Binding Items}">
        <TextBlock Text="{Binding Name}">
          <TextBlock.ContextMenu>
            <ContextMenu>
              <MenuItem
                  Header="{Binding i18n.ContextMenu.NewFolder, Mode=OneWay}"
                  Command="{Binding AddNewFolderCmd}"
                  IsVisible="{Binding !HotKeys.HasMultipleItemsSelected}"/>
              <MenuItem
                  Header="{Binding i18n.ContextMenu.NewHttpRequest, Mode=OneWay}"
                  Command="{Binding AddNewHttpRequestCmd}"
                  IsVisible="{Binding !HotKeys.HasMultipleItemsSelected}"/>
              <MenuItem
                  Header="{Binding i18n.ContextMenu.NewWebSocketConnection, Mode=OneWay}"
                  Command="{Binding AddNewWebSocketConnectionCmd}"
                  IsVisible="{Binding !HotKeys.HasMultipleItemsSelected}"/>
              <MenuItem
                  Header="{Binding i18n.ContextMenu.NewHttpRepeater, Mode=OneWay}"
                  Command="{Binding AddNewHttpRepeaterCmd}"
                  IsVisible="{Binding !HotKeys.HasMultipleItemsSelected}"/>
              <MenuItem
                  Header="{Binding i18n.ContextMenu.Duplicate, Mode=OneWay}"
                  Command="{Binding HotKeys.DuplicateCmd, Mode=OneWay}"
                  InputGesture="Ctrl+D"
                  IsVisible="{Binding !HotKeys.HasMultipleItemsSelected}"/>
              <MenuItem
                  Header="{Binding i18n.ContextMenu.Paste, Mode=OneWay}"
                  Command="{Binding HotKeys.PasteCmd, Mode=OneWay}"
                  InputGesture="Ctrl+V"
                  IsEnabled="{Binding ClipboardArea.CanPasteCollectionFolderOrRequest}"/>
              <MenuItem
                  Header="{Binding i18n.ContextMenu.Rename, Mode=OneWay}"
                  Command="{Binding HotKeys.RenameCmd, Mode=OneWay}"
                  InputGesture="F2"
                  IsVisible="{Binding !HotKeys.HasMultipleItemsSelected}"/>
              <MenuItem
                  Header="{Binding i18n.ContextMenu.MoveUp, Mode=OneWay}"
                  Command="{Binding HotKeys.MoveUpCmd, Mode=OneWay}"
                  InputGesture="Alt+Up"
                  IsEnabled="{Binding CanMoveUp}"
                  IsVisible="{Binding !HotKeys.HasMultipleItemsSelected}"/>
              <MenuItem
                  Header="{Binding i18n.ContextMenu.MoveDown, Mode=OneWay}"
                  Command="{Binding HotKeys.MoveDownCmd, Mode=OneWay}"
                  InputGesture="Alt+Down"
                  IsEnabled="{Binding CanMoveDown}"
                  IsVisible="{Binding !HotKeys.HasMultipleItemsSelected}"/>
              <MenuItem
                  Header="{Binding i18n.ContextMenu.Delete, Mode=OneWay}"
                  Command="{Binding HotKeys.DeleteCmd, Mode=OneWay}"
                  InputGesture="Delete"/>
            </ContextMenu>
          </TextBlock.ContextMenu>
        </TextBlock>
      </TreeDataTemplate>
      <TreeDataTemplate
          DataType="{x:Type vm:CollectionFolderViewModel}"
          ItemsSource="{Binding Items}">
        <TextBlock Text="{Binding Name}">
          <TextBlock.ContextMenu>
            <ContextMenu>
              <MenuItem
                  Header="{Binding i18n.ContextMenu.NewFolder, Mode=OneWay}"
                  Command="{Binding AddNewFolderCmd}"
                  IsVisible="{Binding !HotKeys.HasMultipleItemsSelected}"/>
              <MenuItem
                  Header="{Binding i18n.ContextMenu.NewHttpRequest, Mode=OneWay}"
                  Command="{Binding AddNewHttpRequestCmd}"
                  IsVisible="{Binding !HotKeys.HasMultipleItemsSelected}"/>
              <MenuItem
                  Header="{Binding i18n.ContextMenu.NewWebSocketConnection, Mode=OneWay}"
                  Command="{Binding AddNewWebSocketConnectionCmd}"
                  IsVisible="{Binding !HotKeys.HasMultipleItemsSelected}"/>
              <MenuItem
                  Header="{Binding i18n.ContextMenu.NewHttpRepeater, Mode=OneWay}"
                  Command="{Binding AddNewHttpRepeaterCmd}"
                  IsVisible="{Binding !HotKeys.HasMultipleItemsSelected}"/>
              <MenuItem
                  Header="{Binding i18n.ContextMenu.Cut, Mode=OneWay}"
                  Command="{Binding HotKeys.CutCmd, Mode=OneWay}"
                  InputGesture="Ctrl+X"/>
              <MenuItem
                  Header="{Binding i18n.ContextMenu.Copy, Mode=OneWay}"
                  Command="{Binding HotKeys.CopyCmd, Mode=OneWay}"
                  InputGesture="Ctrl+C"/>
              <MenuItem
                  Header="{Binding i18n.ContextMenu.Paste, Mode=OneWay}"
                  Command="{Binding HotKeys.PasteCmd, Mode=OneWay}"
                  InputGesture="Ctrl+V"
                  IsEnabled="{Binding ClipboardArea.CanPasteCollectionFolderOrRequest}"/>
              <MenuItem
                  Header="{Binding i18n.ContextMenu.Rename, Mode=OneWay}"
                  Command="{Binding HotKeys.RenameCmd, Mode=OneWay}"
                  InputGesture="F2"
                  IsVisible="{Binding !HotKeys.HasMultipleItemsSelected}"/>
              <MenuItem
                  Header="{Binding i18n.ContextMenu.MoveUp, Mode=OneWay}"
                  Command="{Binding HotKeys.MoveUpCmd, Mode=OneWay}"
                  InputGesture="Alt+Up"
                  IsEnabled="{Binding CanMoveUp}"
                  IsVisible="{Binding !HotKeys.HasMultipleItemsSelected}"/>
              <MenuItem
                  Header="{Binding i18n.ContextMenu.MoveDown, Mode=OneWay}"
                  Command="{Binding HotKeys.MoveDownCmd, Mode=OneWay}"
                  InputGesture="Alt+Down"
                  IsEnabled="{Binding CanMoveDown}"
                  IsVisible="{Binding !HotKeys.HasMultipleItemsSelected}"/>
              <MenuItem
                  Header="{Binding i18n.ContextMenu.Delete, Mode=OneWay}"
                  Command="{Binding HotKeys.DeleteCmd, Mode=OneWay}"
                  InputGesture="Delete"/>
            </ContextMenu>
          </TextBlock.ContextMenu>
        </TextBlock>
      </TreeDataTemplate>
      <TreeDataTemplate
          DataType="{x:Type vm:EnvironmentsGroupViewModel}"
          ItemsSource="{Binding Items}">
        <StackPanel Orientation="Horizontal">
          <StackPanel.ContextMenu>
            <ContextMenu>
              <MenuItem
                  Header="{Binding i18n.ContextMenu.NewEnvironment, Mode=OneWay}"
                  Command="{Binding AddNewEnvironmentCmd}"
                  IsVisible="{Binding !HotKeys.HasMultipleItemsSelected}"/>
              <MenuItem
                  Header="{Binding i18n.ContextMenu.Paste, Mode=OneWay}"
                  Command="{Binding HotKeys.PasteCmd, Mode=OneWay}"
                  InputGesture="Ctrl+V"
                  IsEnabled="{Binding ClipboardArea.CanPasteEnvironment}"/>
              <MenuItem
                  Header="{Binding i18n.ContextMenu.ImportEnvironment, Mode=OneWay}"
                  Command="{Binding ImportEnvironmentsCmd}"
                  IsVisible="{Binding !HotKeys.HasMultipleItemsSelected}"/>
            </ContextMenu>
          </StackPanel.ContextMenu>
          <TextBlock Text="{Binding i18n.CollectionsGroup.Environments, Mode=OneWay}"/>
          <TextBlock
              Foreground="{DynamicResource CurrentEnvironmentLabelColor}"
              Text="{Binding SelectedEnvironmentName}"/>
        </StackPanel>
      </TreeDataTemplate>
      <DataTemplate DataType="{x:Type vm:HttpRequestViewModel}">
        <TextBlock Text="{Binding Name}">
          <TextBlock.ContextMenu>
            <ContextMenu>
              <MenuItem
                  Header="{Binding i18n.ContextMenu.Cut, Mode=OneWay}"
                  Command="{Binding HotKeys.CutCmd, Mode=OneWay}"
                  InputGesture="Ctrl+X"/>
              <MenuItem
                  Header="{Binding i18n.ContextMenu.Copy, Mode=OneWay}"
                  Command="{Binding HotKeys.CopyCmd, Mode=OneWay}"
                  InputGesture="Ctrl+C"/>
              <MenuItem
                  Header="{Binding i18n.ContextMenu.Rename, Mode=OneWay}"
                  Command="{Binding HotKeys.RenameCmd, Mode=OneWay}"
                  InputGesture="F2"
                  IsVisible="{Binding !HotKeys.HasMultipleItemsSelected}"/>
              <MenuItem
                  Header="{Binding i18n.ContextMenu.MoveUp, Mode=OneWay}"
                  Command="{Binding HotKeys.MoveUpCmd, Mode=OneWay}"
                  InputGesture="Alt+Up"
                  IsEnabled="{Binding CanMoveUp}"
                  IsVisible="{Binding !HotKeys.HasMultipleItemsSelected}"/>
              <MenuItem
                  Header="{Binding i18n.ContextMenu.MoveDown, Mode=OneWay}"
                  Command="{Binding HotKeys.MoveDownCmd, Mode=OneWay}"
                  InputGesture="Alt+Down"
                  IsEnabled="{Binding CanMoveDown}"
                  IsVisible="{Binding !HotKeys.HasMultipleItemsSelected}"/>
              <MenuItem
                  Header="{Binding i18n.ContextMenu.Delete, Mode=OneWay}"
                  Command="{Binding HotKeys.DeleteCmd, Mode=OneWay}"
                  InputGesture="Delete"/>
            </ContextMenu>
          </TextBlock.ContextMenu>
        </TextBlock>
      </DataTemplate>
      <DataTemplate DataType="{x:Type vm:HttpRepeaterViewModel}">
        <TextBlock Text="{Binding Name}">
          <TextBlock.ContextMenu>
            <ContextMenu>
              <MenuItem
                  Header="{Binding i18n.ContextMenu.Cut, Mode=OneWay}"
                  Command="{Binding HotKeys.CutCmd, Mode=OneWay}"
                  InputGesture="Ctrl+X"/>
              <MenuItem
                  Header="{Binding i18n.ContextMenu.Copy, Mode=OneWay}"
                  Command="{Binding HotKeys.CopyCmd, Mode=OneWay}"
                  InputGesture="Ctrl+C"/>
              <MenuItem
                  Header="{Binding i18n.ContextMenu.Rename, Mode=OneWay}"
                  Command="{Binding HotKeys.RenameCmd, Mode=OneWay}"
                  InputGesture="F2"
                  IsVisible="{Binding !HotKeys.HasMultipleItemsSelected}"/>
              <MenuItem
                  Header="{Binding i18n.ContextMenu.MoveUp, Mode=OneWay}"
                  Command="{Binding HotKeys.MoveUpCmd, Mode=OneWay}"
                  InputGesture="Alt+Up"
                  IsEnabled="{Binding CanMoveUp}"
                  IsVisible="{Binding !HotKeys.HasMultipleItemsSelected}"/>
              <MenuItem
                  Header="{Binding i18n.ContextMenu.MoveDown, Mode=OneWay}"
                  Command="{Binding HotKeys.MoveDownCmd, Mode=OneWay}"
                  InputGesture="Alt+Down"
                  IsEnabled="{Binding CanMoveDown}"
                  IsVisible="{Binding !HotKeys.HasMultipleItemsSelected}"/>
              <MenuItem
                  Header="{Binding i18n.ContextMenu.Delete, Mode=OneWay}"
                  Command="{Binding HotKeys.DeleteCmd, Mode=OneWay}"
                  InputGesture="Delete"/>
            </ContextMenu>
          </TextBlock.ContextMenu>
        </TextBlock>
      </DataTemplate>
      <TreeDataTemplate
          DataType="{x:Type vm:WebSocketConnectionViewModel}"
          ItemsSource="{Binding Items}">
        <TextBlock Text="{Binding Name}">
          <TextBlock.ContextMenu>
            <ContextMenu>
              <MenuItem
                  Header="{Binding i18n.ContextMenu.NewWebSocketClientMessage, Mode=OneWay}"
                  Command="{Binding AddNewWebSocketClientMessageCmd}"
                  IsVisible="{Binding !HotKeys.HasMultipleItemsSelected}"/>
              <MenuItem
                  Header="{Binding i18n.ContextMenu.Cut, Mode=OneWay}"
                  Command="{Binding HotKeys.CutCmd, Mode=OneWay}"
                  InputGesture="Ctrl+X"/>
              <MenuItem
                  Header="{Binding i18n.ContextMenu.Copy, Mode=OneWay}"
                  Command="{Binding HotKeys.CopyCmd, Mode=OneWay}"
                  InputGesture="Ctrl+C"/>
              <MenuItem
                  Header="{Binding i18n.ContextMenu.Paste, Mode=OneWay}"
                  Command="{Binding HotKeys.PasteCmd, Mode=OneWay}"
                  InputGesture="Ctrl+V"
                  IsEnabled="{Binding ClipboardArea.CanPasteWebSocketClientMessage}"/>
              <MenuItem
                  Header="{Binding i18n.ContextMenu.Rename, Mode=OneWay}"
                  Command="{Binding HotKeys.RenameCmd, Mode=OneWay}"
                  InputGesture="F2"
                  IsVisible="{Binding !HotKeys.HasMultipleItemsSelected}"/>
              <MenuItem
                  Header="{Binding i18n.ContextMenu.MoveUp, Mode=OneWay}"
                  Command="{Binding HotKeys.MoveUpCmd, Mode=OneWay}"
                  InputGesture="Alt+Up"
                  IsEnabled="{Binding CanMoveUp}"
                  IsVisible="{Binding !HotKeys.HasMultipleItemsSelected}"/>
              <MenuItem
                  Header="{Binding i18n.ContextMenu.MoveDown, Mode=OneWay}"
                  Command="{Binding HotKeys.MoveDownCmd, Mode=OneWay}"
                  InputGesture="Alt+Down"
                  IsEnabled="{Binding CanMoveDown}"
                  IsVisible="{Binding !HotKeys.HasMultipleItemsSelected}"/>
              <MenuItem
                  Header="{Binding i18n.ContextMenu.Delete, Mode=OneWay}"
                  Command="{Binding HotKeys.DeleteCmd, Mode=OneWay}"
                  InputGesture="Delete"/>
            </ContextMenu>
          </TextBlock.ContextMenu>
        </TextBlock>
      </TreeDataTemplate>
      <DataTemplate DataType="{x:Type vm:WebSocketClientMessageViewModel}">
        <TextBlock Text="{Binding Name}">
          <TextBlock.ContextMenu>
            <ContextMenu>
              <MenuItem
                  Header="{Binding i18n.ContextMenu.Cut, Mode=OneWay}"
                  Command="{Binding HotKeys.CutCmd, Mode=OneWay}"
                  InputGesture="Ctrl+X"/>
              <MenuItem
                  Header="{Binding i18n.ContextMenu.Copy, Mode=OneWay}"
                  Command="{Binding HotKeys.CopyCmd, Mode=OneWay}"
                  InputGesture="Ctrl+C"/>
              <MenuItem
                  Header="{Binding i18n.ContextMenu.Rename, Mode=OneWay}"
                  Command="{Binding HotKeys.RenameCmd, Mode=OneWay}"
                  InputGesture="F2"
                  IsVisible="{Binding !HotKeys.HasMultipleItemsSelected}"/>
              <MenuItem
                  Header="{Binding i18n.ContextMenu.MoveUp, Mode=OneWay}"
                  Command="{Binding HotKeys.MoveUpCmd, Mode=OneWay}"
                  InputGesture="Alt+Up"
                  IsEnabled="{Binding CanMoveUp}"
                  IsVisible="{Binding !HotKeys.HasMultipleItemsSelected}"/>
              <MenuItem
                  Header="{Binding i18n.ContextMenu.MoveDown, Mode=OneWay}"
                  Command="{Binding HotKeys.MoveDownCmd, Mode=OneWay}"
                  InputGesture="Alt+Down"
                  IsEnabled="{Binding CanMoveDown}"
                  IsVisible="{Binding !HotKeys.HasMultipleItemsSelected}"/>
              <MenuItem
                  Header="{Binding i18n.ContextMenu.Delete, Mode=OneWay}"
                  Command="{Binding HotKeys.DeleteCmd, Mode=OneWay}"
                  InputGesture="Delete"/>
            </ContextMenu>
          </TextBlock.ContextMenu>
        </TextBlock>
      </DataTemplate>
      <DataTemplate DataType="{x:Type vm:EnvironmentViewModel}">
        <StackPanel Orientation="Horizontal">
          <StackPanel.ContextMenu>
            <ContextMenu>
              <MenuItem
                  Header="{Binding i18n.ContextMenu.SetAsCurrentEnvironment, Mode=OneWay}"
                  Command="{Binding ToggleEnabledEnvironmentCmd}"
                  IsEnabled="{Binding !IsCurrentEnvironment}"
                  IsVisible="{Binding !HotKeys.HasMultipleItemsSelected}"/>
              <MenuItem
                  Header="{Binding i18n.ContextMenu.Cut, Mode=OneWay}"
                  Command="{Binding HotKeys.CutCmd, Mode=OneWay}"
                  InputGesture="Ctrl+X"/>
              <MenuItem
                  Header="{Binding i18n.ContextMenu.Copy, Mode=OneWay}"
                  Command="{Binding HotKeys.CopyCmd, Mode=OneWay}"
                  InputGesture="Ctrl+C"/>
              <MenuItem
                  Header="{Binding i18n.ContextMenu.Rename, Mode=OneWay}"
                  Command="{Binding HotKeys.RenameCmd, Mode=OneWay}"
                  InputGesture="F2"
                  IsVisible="{Binding !HotKeys.HasMultipleItemsSelected}"/>
              <MenuItem
                  Header="{Binding i18n.ContextMenu.MoveUp, Mode=OneWay}"
                  Command="{Binding HotKeys.MoveUpCmd, Mode=OneWay}"
                  InputGesture="Alt+Up"
                  IsEnabled="{Binding CanMoveUp}"
                  IsVisible="{Binding !HotKeys.HasMultipleItemsSelected}"/>
              <MenuItem
                  Header="{Binding i18n.ContextMenu.MoveDown, Mode=OneWay}"
                  Command="{Binding HotKeys.MoveDownCmd, Mode=OneWay}"
                  InputGesture="Alt+Down"
                  IsEnabled="{Binding CanMoveDown}"
                  IsVisible="{Binding !HotKeys.HasMultipleItemsSelected}"/>
              <MenuItem
                  Header="{Binding i18n.ContextMenu.Delete, Mode=OneWay}"
                  InputGesture="Delete"
                  Command="{Binding HotKeys.DeleteCmd, Mode=OneWay}"/>
            </ContextMenu>
          </StackPanel.ContextMenu>
          <Image
              IsVisible="{Binding IsCurrentEnvironment}"
              Width="12"
              Height="12"
              Margin="0,0,8,0"
              VerticalAlignment="Center"
              HorizontalAlignment="Center">
            <Image.Source>
              <DrawingImage Drawing="{StaticResource IconCheck}"/>
            </Image.Source>
          </Image>
          <TextBlock Text="{Binding Name}"/>
        </StackPanel>
      </DataTemplate>
      <DataTemplate DataType="{x:Type vm:CollectionVariablesViewModel}">
        <TextBlock Text="{Binding i18n.CollectionsGroup.Variables, Mode=OneWay}"/>
      </DataTemplate>
      <DataTemplate DataType="{x:Type vm:CollectionScopedAuthViewModel}">
        <TextBlock Text="{Binding i18n.CollectionsGroup.CollectionScopedAuth, Mode=OneWay}"/>
      </DataTemplate>

    </TreeView.DataTemplates>

  </TreeView>
</UserControl>